<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaci√≥n qu√≠mica</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --error: #c0392b;
            --bg: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            overflow: hidden;
            position: relative;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background: #34495e;
            color: #bdc3c7;
            font-size: 0.9em;
        }

        .question-area {
            padding: 30px 20px;
            text-align: center;
        }

        .chemical-formula {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 20px;
            height: 60px; /* reserva espacio */
        }

        .instruction {
            color: #7f8c8d;
            margin-bottom: 25px;
            font-style: italic;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            padding: 0 20px 30px;
        }

        @media (min-width: 500px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        button.option-btn {
            background: white;
            border: 2px solid var(--accent);
            color: var(--primary);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s;
        }

        button.option-btn:hover {
            background: var(--accent);
            color: white;
        }

        button.option-btn.correct {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
        }

        button.option-btn.wrong {
            background-color: var(--error);
            border-color: var(--error);
            color: white;
        }

        .feedback-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            display: none; /* Hidden by default */
            text-align: center;
        }

        .next-btn {
            margin-top: 20px;
            padding: 12px 30px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
        }

        /* Sub√≠ndices qu√≠micos */
        sub {
            font-size: 0.6em;
        }
    </style>
</head>
<body>

<div class="game-container">
    <header>
        <h1>üß™ Qu√≠mica</h1>
    </header>
    
    <div class="stats-bar">
        <span id="score">Puntos: 0</span>
        <span id="streak">Racha: 0</span>
        <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
    </div>

    <div class="question-area">
        <div class="instruction" id="instruction">Selecciona la respuesta correcta:</div>
        <div class="chemical-formula" id="display">Cargando...</div>
    </div>

    <div class="options-grid" id="options-container">
        </div>

    <div class="feedback-modal" id="modal">
        <h2 id="modal-title">¬°Correcto!</h2>
        <p id="modal-msg">Muy bien hecho.</p>
        <button class="next-btn" onclick="nextQuestion()">Siguiente Pregunta</button>
    </div>
</div>

<script>
    // --- BASE DE DATOS DE PREGUNTAS ---
    // Tipos: 1 = F√≥rmula a Nombre, 2 = Nombre a F√≥rmula
    const database = [
    // --- √ìXIDOS MET√ÅLICOS Y NO MET√ÅLICOS ---
    { type: 1, val: "Na2O", correct: "√ìxido de sodio", distractors: ["Di√≥xido de sodio", "√ìxido de disodio(I)", "√ìxido s√≥dico"], error_explanation: ""},
    { type: 1, val: "FeO", correct: "√ìxido de hierro(II)", distractors: ["√ìxido de hierro(III)", "Mon√≥xido de dihierro", "√ìxido f√©rrico"] , error_explanation: "" },
    { type: 1, val: "Fe2O3", correct: "Tri√≥xido de dihierro", distractors: ["√ìxido de hierro(II)", "Di√≥xido de trihierro", "√ìxido ferroso"] , error_explanation: "" },
    { type: 1, val: "CaO", correct: "√ìxido de calcio", distractors: ["Mon√≥xido de dicalcio", "√ìxido c√°lcico(II)", "Calcio oxigenado"] , error_explanation: "" },
    { type: 1, val: "PbO2", correct: "Di√≥xido de plomo", distractors: ["√ìxido de plomo(II)", "√ìxido plumboso", "Mon√≥xido de plomo"] , error_explanation: "" },
    { type: 1, val: "Cu2O", correct: "√ìxido de cobre(I)", distractors: ["√ìxido de cobre(II)", "Di√≥xido de cobre", "√ìxido c√∫prico"] , error_explanation: "" },
    { type: 1, val: "Al2O3", correct: "√ìxido de aluminio", distractors: ["Tri√≥xido de aluminio", "√ìxido de aluminio(II)", "Al√∫mina"] , error_explanation: "" }, // Nota: Tri√≥xido de dialuminio tambi√©n es correcto, pero √ìxido de aluminio es la preferida IUPAC al tener valencia √∫nica.
    
    { type: 2, val: "Di√≥xido de carbono", correct: "CO2", distractors: ["CO", "C2O", "C2O3"] , error_explanation: "" },
    { type: 2, val: "√ìxido de azufre(VI)", correct: "SO3", distractors: ["SO2", "S2O3", "SO"] , error_explanation: "" },
    { type: 2, val: "Mon√≥xido de carbono", correct: "CO", distractors: ["CO2", "C2O", "CoO"] , error_explanation: "" },
    { type: 2, val: "√ìxido de dicloro", correct: "Cl2O", distractors: ["ClO2", "Cl2O3", "ClO"] , error_explanation: "" },
    { type: 2, val: "Hept√≥xido de dimanganeso", correct: "Mn2O7", distractors: ["Mn7O2", "MnO7", "Mn2O5"] , error_explanation: "" },
    { type: 2, val: "√ìxido de plata", correct: "Ag2O", distractors: ["AgO", "AgO2", "PlO"] , error_explanation: "" },

    // --- HIDRUROS (Met√°licos y Vol√°tiles/√Åcidos) ---
    { type: 1, val: "LiH", correct: "Hidruro de litio", distractors: ["Hidr√≥xido de litio", "Monohidruro de dilitio", "Litio h√≠drico"] , error_explanation: "" },
    { type: 1, val: "CaH2", correct: "Dihidruro de calcio", distractors: ["Hidruro de calcio(I)", "Hidr√≥xido c√°lcico", "Calciohidruro"] , error_explanation: "" },
    { type: 1, val: "AlH3", correct: "Hidruro de aluminio", distractors: ["Trihidruro de monoaluminio", "Aluminio h√≠drico", "Hidr√≥xido de aluminio"] , error_explanation: "" },
    { type: 1, val: "KH", correct: "Hidruro de potasio", distractors: ["Hidruro pot√°sico(I)", "Kaliohidruro", "Hidr√≥xido de potasio"] , error_explanation: "" },
    { type: 1, val: "H2S", correct: "Sulfuro de hidr√≥geno", distractors: ["Hidruro de azufre", "√Åcido sulf√∫rico", "Sulfato de hidr√≥geno"] , error_explanation: "" },
    
    { type: 2, val: "Amon√≠aco (Azano)", correct: "NH3", distractors: ["NH4", "NH2", "N3H"] , error_explanation: "" },
    { type: 2, val: "√Åcido clorh√≠drico (disoluci√≥n)", correct: "HCl", distractors: ["ClH", "H2Cl", "ClOH"] , error_explanation: "" },
    { type: 2, val: "Metano", correct: "CH4", distractors: ["CH3", "C2H6", "MH4"] , error_explanation: "" },
    { type: 2, val: "Hidruro de hierro(III)", correct: "FeH3", distractors: ["FeH2", "Fe3H", "FeOH3"] , error_explanation: "" },
    { type: 2, val: "Fluoruro de hidr√≥geno", correct: "HF", distractors: ["FH", "H2F", "HFL"] , error_explanation: "" },

    // --- HIDR√ìXIDOS ---
    { type: 1, val: "NaOH", correct: "Hidr√≥xido de sodio", distractors: ["√ìxido de sodio", "Hidruro de sodio", "Sodiohidr√≥xido"] , error_explanation: "" },
    { type: 1, val: "Mg(OH)2", correct: "Dihidr√≥xido de magnesio", distractors: ["Hidr√≥xido de magnesio(I)", "Hidruro de magnesio", "√ìxido de magnesio"] , error_explanation: "" },
    { type: 1, val: "KOH", correct: "Hidr√≥xido de potasio", distractors: ["Hidr√≥xido pot√°sico(I)", "√ìxido de potasio", "Potasa"] , error_explanation: "" },
    { type: 1, val: "Ba(OH)2", correct: "Hidr√≥xido de bario", distractors: ["Dihidr√≥xido de bario(II)", "√ìxido de bario", "Bariohidr√≥xido"] , error_explanation: "" },
    
    { type: 2, val: "Hidr√≥xido de hierro(III)", correct: "Fe(OH)3", distractors: ["Fe(OH)2", "Fe3OH", "FeOH"] , error_explanation: "" },
    { type: 2, val: "Hidr√≥xido de aluminio", correct: "Al(OH)3", distractors: ["AlOH3", "Al(OH)2", "Al3OH"] , error_explanation: "" },
    { type: 2, val: "Dihidr√≥xido de plomo", correct: "Pb(OH)2", distractors: ["Pb(OH)4", "Pb2OH", "Pl(OH)2"] , error_explanation: "" },
    { type: 2, val: "Hidr√≥xido de litio", correct: "LiOH", distractors: ["Li(OH)2", "LiHO", "LOH"] , error_explanation: "" },

    // --- SALES BINARIAS (Neutras) ---
    { type: 1, val: "NaCl", correct: "Cloruro de sodio", distractors: ["Clorato de sodio", "Sodiocloruro", "Clorito s√≥dico"] , error_explanation: "" },
    { type: 1, val: "FeS", correct: "Sulfuro de hierro(II)", distractors: ["Sulfuro de hierro(III)", "Sulfato de hierro", "Sulfuro ferroso"] , error_explanation: "" },
    { type: 1, val: "K2S", correct: "Sulfuro de potasio", distractors: ["Sulfato de potasio", "Disulfuro de potasio", "Sulfuro pot√°sico(II)"] , error_explanation: "" },
    { type: 1, val: "CaBr2", correct: "Bromuro de calcio", distractors: ["Dibromuro de calcio(II)", "Bromito de calcio", "Calcio bromado"] , error_explanation: "" },
    { type: 1, val: "AlCl3", correct: "Tricloruro de aluminio", distractors: ["Cloruro de aluminio(III)", "Clorato de aluminio", "Aluminio clorado"] , error_explanation: "" },
    { type: 1, val: "KI", correct: "Yoduro de potasio", distractors: ["Yodato de potasio", "Yoduro pot√°sico(I)", "Potasio yodado"] , error_explanation: "" },

    { type: 2, val: "Tricloruro de hierro", correct: "FeCl3", distractors: ["FeCl2", "Fe3Cl", "Cl3Fe"] , error_explanation: "" },
    { type: 2, val: "Fluoruro de calcio", correct: "CaF2", distractors: ["CaF", "Ca2F", "CF2"] , error_explanation: "" },
    { type: 2, val: "Sulfuro de plomo(IV)", correct: "PbS2", distractors: ["PbS", "Pb2S", "Pb4S"] , error_explanation: "" },
    { type: 2, val: "Bromuro de cobre(II)", correct: "CuBr2", distractors: ["CuBr", "Cu2Br", "CoBr2"] , error_explanation: "" },
    { type: 2, val: "Cloruro de magnesio", correct: "MgCl2", distractors: ["MgCl", "Mg2Cl", "MnCl2"] , error_explanation: "" },
    
    // --- M√ÅS √ìXIDOS (Elementos "trampa" y valencias variables) ---
    { type: 1, val: "Au2O3", correct: "√ìxido de oro(III)", distractors: ["√ìxido de oro(II)", "Tri√≥xido de oro", "√ìxido √°ureo"] , error_explanation: "" },
    { type: 1, val: "HgO", correct: "√ìxido de mercurio(II)", distractors: ["√ìxido de mercurio(I)", "Mon√≥xido de mercurio", "√ìxido merc√∫rico"] , error_explanation: "" },
    { type: 1, val: "ZnO", correct: "√ìxido de zinc", distractors: ["√ìxido de zinc(II)", "Mon√≥xido de zinc", "√ìxido z√≠ncico"] , error_explanation: "" }, // Zinc solo tiene valencia 2, no se pone (II)
    { type: 1, val: "SnO2", correct: "Di√≥xido de esta√±o", distractors: ["√ìxido de esta√±o(II)", "√ìxido de esta√±o", "Di√≥xido de monoesta√±o"] , error_explanation: "" },
    { type: 1, val: "NiO", correct: "√ìxido de n√≠quel(II)", distractors: ["√ìxido de n√≠quel(III)", "Mon√≥xido de n√≠quel", "√ìxido niqueloso"] , error_explanation: "" },
    
    { type: 2, val: "√ìxido de platino(IV)", correct: "PtO2", distractors: ["PtO4", "Pt2O4", "PtO"] , error_explanation: "" },
    { type: 2, val: "√ìxido de litio", correct: "Li2O", distractors: ["LiO", "LiO2", "Li2O3"] , error_explanation: "" },
    { type: 2, val: "Tri√≥xido de azufre", correct: "SO3", distractors: ["SO2", "S3O", "S2O3"] , error_explanation: "" }, // Muy com√∫n confundirlo con el sulfito
    { type: 2, val: "√ìxido de cromo(III)", correct: "Cr2O3", distractors: ["CrO3", "Cr3O2", "CrO"] , error_explanation: "" },

    // --- PER√ìXIDOS (Opcional en 3¬∫ ESO, pero habitual: Agua Oxigenada) ---
    { type: 1, val: "H2O2", correct: "Per√≥xido de hidr√≥geno", distractors: ["Di√≥xido de dihidr√≥geno", "√ìxido de agua", "Hidruro de ox√≠geno"] , error_explanation: "" },
    { type: 2, val: "Per√≥xido de sodio", correct: "Na2O2", distractors: ["NaO", "Na2O", "NaO2"] , error_explanation: "" },

    // --- M√ÅS HIDRUROS Y COMPUESTOS CON NOMBRES PROPIOS ---
    { type: 1, val: "PH3", correct: "Fosfano", distractors: ["Fosfina", "Trihidruro de f√≥sforo", "F√≥sforo h√≠drico"] , error_explanation: "" }, // IUPAC prefiere Fosfano
    { type: 1, val: "SiH4", correct: "Silano", distractors: ["Tetrahidruro de silicio", "Silicio h√≠drico", "Hidruro de silicio"] , error_explanation: "" },
    { type: 1, val: "SbH3", correct: "Estibano", distractors: ["Antimonano", "Hidruro de antimonio", "Estibina"] , error_explanation: "" },
    { type: 1, val: "HBr(aq)", correct: "√Åcido bromh√≠drico", distractors: ["Bromuro de hidr√≥geno", "Hidruro de bromo", "Bromhidruro"] , error_explanation: "" }, // En disoluci√≥n acuosa
    { type: 1, val: "H2Se", correct: "Seleniuro de hidr√≥geno", distractors: ["Hidruro de selenio", "√Åcido selenh√≠drico", "Seleniuro h√≠drico"] , error_explanation: "" }, // En estado gaseoso

    { type: 2, val: "Arsano", correct: "AsH3", distractors: ["ArH3", "AsH4", "AhH3"] , error_explanation: "" },
    { type: 2, val: "Yoduro de hidr√≥geno", correct: "HI", distractors: ["H2I", "IH", "HId"] , error_explanation: "" },
    { type: 2, val: "Tetrahidruro de esta√±o", correct: "SnH4", distractors: ["SnH2", "ThH4", "Sn4H"] , error_explanation: "" },
    
    // --- M√ÅS HIDR√ìXIDOS ---
    { type: 1, val: "Be(OH)2", correct: "Hidr√≥xido de berilio", distractors: ["Dihidr√≥xido de berilio(II)", "√ìxido de berilio", "Beriliohidr√≥xido"] , error_explanation: "" },
    { type: 1, val: "HgOH", correct: "Hidr√≥xido de mercurio(I)", distractors: ["Hidr√≥xido de mercurio(II)", "Hidr√≥xido mercuroso", "Mercurio hidr√≥xido"] , error_explanation: "" },
    { type: 1, val: "Cd(OH)2", correct: "Hidr√≥xido de cadmio", distractors: ["Hidr√≥xido de cadmio(II)", "Dihidr√≥xido de cadmio", "Cadmio hidroxilado"] , error_explanation: "" },
    
    { type: 2, val: "Hidr√≥xido de cesio", correct: "CsOH", distractors: ["CeOH", "Cs(OH)2", "CoH"] , error_explanation: "" },
    { type: 2, val: "Hidr√≥xido de n√≠quel(III)", correct: "Ni(OH)3", distractors: ["Ni(OH)2", "Ni3OH", "NOH3"] , error_explanation: "" },
    { type: 2, val: "Dihidr√≥xido de cobalto", correct: "Co(OH)2", distractors: ["Co(OH)3", "Cb(OH)2", "Co2OH"] , error_explanation: "" },

    // --- M√ÅS SALES BINARIAS (Neutras y Vol√°tiles) ---
    { type: 1, val: "AgCl", correct: "Cloruro de plata", distractors: ["Cloruro de plata(I)", "Clorato de plata", "Plata clorada"] , error_explanation: "" }, // Plata valencia √∫nica, no lleva (I)
    { type: 1, val: "AuBr3", correct: "Tribromuro de oro", distractors: ["Bromuro de oro", "Bromuro de oro(I)", "√ìxido de oro"] , error_explanation: "" },
    { type: 1, val: "CCl4", correct: "Tetracloruro de carbono", distractors: ["Cloruro de carbono(IV)", "Metano clorado", "Carbocloruro"] , error_explanation: "" }, // Sal vol√°til muy com√∫n
    { type: 1, val: "CS2", correct: "Disulfuro de carbono", distractors: ["Sulfuro de carbono", "Carburo de azufre", "Sulfato de carbono"] , error_explanation: "" },
    { type: 1, val: "MgCl2", correct: "Dicloruro de magnesio", distractors: ["Cloruro de magnesio(II)", "Clorito de magnesio", "Magnesio diclorado"] , error_explanation: "" },
    { type: 1, val: "KCN", correct: "Cianuro de potasio", distractors: ["Cianato de potasio", "Nitruro de carbono y potasio", "Carbonitruro pot√°sico"] , error_explanation: "" }, // Un poco avanzada pero a veces sale como curiosidad

    // √ìxidos de Nitr√≥geno (Casos especiales y muy comunes)
    { type: 1, val: "N2O3", correct: "Tri√≥xido de dinitr√≥geno", distractors: ["√ìxido de nitr√≥geno(II)", "√ìxido nitroso", "Tri√≥xido de nitr√≥geno"] , error_explanation: "" },
    { type: 1, val: "N2O5", correct: "Penta√≥xido de dinitr√≥geno", distractors: ["√ìxido de nitr√≥geno(III)", "Pent√≥xido de nitr√≥geno", "√ìxido n√≠trico"] , error_explanation: "" },
    { type: 2, val: "Di√≥xido de nitr√≥geno", correct: "NO2", distractors: ["N2O", "NO", "N2O4"] , error_explanation: "" },

    // Hidruros y √Åcidos Hidr√°cidos
    { type: 1, val: "HI(acuoso)", correct: "√Åcido yodh√≠drico", distractors: ["Yoduro de hidr√≥geno", "Hidruro de yodo", "Yodhidruro"] , error_explanation: "" },
    { type: 2, val: "Borano", correct: "BH3", distractors: ["B3H", "BH", "B(OH)3"] , error_explanation: "" },
    { type: 2, val: "Seleniuro de hidr√≥geno", correct: "H2Se", distractors: ["SeH2", "HSe", "SeH"] , error_explanation: "" },

    // Sales Binarias (M√°s combinaciones de valencias)
    { type: 1, val: "CuS", correct: "Sulfuro de cobre(II)", distractors: ["Sulfuro de cobre(I)", "Monosulfuro de cobre", "Sulfuro c√∫prico"] , error_explanation: "" },
    { type: 1, val: "MnBr2", correct: "Dibromuro de manganeso", distractors: ["Bromuro de manganeso(III)", "Bromuro magn√©sico", "MnBr"] , error_explanation: "" },
    { type: 2, val: "Tricloruro de cobalto", correct: "CoCl3", distractors: ["CoCl2", "Co3Cl", "Cl3Co"] , error_explanation: "" },
    { type: 2, val: "Fluoruro de plata", correct: "AgF", distractors: ["AgF2", "Ag2F", "PlF"] , error_explanation: "" },

    // Sales Vol√°tiles (No metal + No metal)
    { type: 1, val: "IF7", correct: "Heptafluoruro de yodo", distractors: ["Fluoruro de yodo(VII)", "Heptafluoro de yodo", "Yoduro de fl√∫or"] , error_explanation: "" },
    { type: 2, val: "Trisulfuro de dif√≥sforo", correct: "P2S3", distractors: ["P3S2", "PS3", "P2S"] , error_explanation: "" },
    { type: 2, val: "Tetranitruro de trisilicio", correct: "Si3N4", distractors: ["Si4N3", "SiN", "Si3N"] , error_explanation: "" },

    { type: 2, val: "Nitruro de magnesio", correct: "Mg3N2", distractors: ["MgN", "Mg2N3", "Mn3N2"] , error_explanation: "" }, // Cruce de valencias dif√≠cil (Mg=2, N=3)
    { type: 2, val: "Sulfuro de plomo(II)", correct: "PbS", distractors: ["PbS2", "Pb2S", "PbSO3"] , error_explanation: "" }, // Simplificaci√≥n Pb2S2 -> PbS
    { type: 2, val: "Fluoruro de azufre(VI)", correct: "SF6", distractors: ["SF4", "S6F", "FS6"] , error_explanation: "" },
    { type: 2, val: "Yoduro de mercurio(II)", correct: "HgI2", distractors: ["HgI", "Hg2I", "MeI2"] , error_explanation: "" },
    { type: 2, val: "Carburo de calcio", correct: "CaC2", distractors: ["CaC", "Ca2C", "CCa"] , error_explanation: "" },
    { type: 2, val: "Cloruro de amonio", correct: "NH4Cl", distractors: ["NH3Cl", "NCl3", "AmCl"] , error_explanation: ""} // Trampa cl√°sica: cati√≥n amonio
];

    // --- L√ìGICA DEL JUEGO ---
    let score = 0;
    let streak = 0;
    let lives = 3;
    let currentQuestion = null;

    // Formatear n√∫meros para que parezcan sub√≠ndices qu√≠micos (CO2 -> CO‚ÇÇ)
    function formatChemical(str) {
        return str.replace(/(\d+)/g, '<sub>$1</sub>');
    }

    function startGame() {
        score = 0;
        streak = 0;
        lives = 3;
        updateStats();
        loadRandomQuestion();
    }

    function updateStats() {
        document.getElementById('score').innerText = `Puntos: ${score}`;
        document.getElementById('streak').innerText = `Racha: ${streak}`;
        let hearts = "";
        for(let i=0; i<lives; i++) hearts += "‚ù§Ô∏è";
        document.getElementById('lives').innerText = hearts;
    }

    function loadRandomQuestion() {
        if (lives <= 0) return gameOver();

        // Elegir pregunta al azar
        const randomIndex = Math.floor(Math.random() * database.length);
        const data = database[randomIndex];
        currentQuestion = data;

        // Mezclar opciones (correcta + distractores)
        let options = [...data.distractors, data.correct];
        options.sort(() => Math.random() - 0.5);

        // Renderizar en el DOM
        const display = document.getElementById('display');
        const instruction = document.getElementById('instruction');
        const container = document.getElementById('options-container');

        container.innerHTML = ''; // Limpiar botones anteriores

        if (data.type === 1) {
            // Caso: Formula -> Nombre
            instruction.innerText = "¬øCu√°l es el nombre correcto de este compuesto?";
            display.innerHTML = formatChemical(data.val);
        } else {
            // Caso: Nombre -> Formula
            instruction.innerText = "¬øCu√°l es la f√≥rmula de este compuesto?";
            display.innerHTML = data.val;
        }

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            // Si la opci√≥n es una f√≥rmula, formatearla, si es texto, dejarlo tal cual
            btn.innerHTML = (data.type === 2) ? formatChemical(opt) : opt;
            btn.onclick = () => checkAnswer(opt, btn);
            container.appendChild(btn);
        });

        // Ocultar modal
        document.getElementById('modal').style.display = 'none';
    }

    function checkAnswer(selected, btnElement) {
        // Desactivar todos los botones para evitar doble clic
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        const isCorrect = (selected === currentQuestion.correct);

        if (isCorrect) {
            btnElement.classList.add('correct');
            score += 10 + (streak * 2); // Bonus por racha
            streak++;
            showModal(true);
        } else {
            btnElement.classList.add('wrong');
            lives--;
            streak = 0;
            // Resaltar la correcta
            allBtns.forEach(b => {
                let textCheck = (currentQuestion.type === 2) ? formatChemical(currentQuestion.correct) : currentQuestion.correct;
                // Peque√±o truco para comparar el innerHTML formateado
                if(b.innerHTML === textCheck) b.classList.add('correct');
            });
            showModal(false);
        }
        updateStats();
    }

    function showModal(isWin) {
        const modal = document.getElementById('modal');
        const title = document.getElementById('modal-title');
        const msg = document.getElementById('modal-msg');
        const btn = document.querySelector('.next-btn');

        modal.style.display = 'flex';
        
        if (lives <= 0) {
            title.innerText = "¬°Juego Terminado!";
            title.style.color = "var(--error)";
            msg.innerText = `Puntuaci√≥n final: ${score}`;
            btn.innerText = "Reiniciar Juego";
            btn.onclick = startGame;
            return;
        }

        if (isWin) {
            title.innerText = "¬°Correcto!";
            title.style.color = "var(--success)";
            msg.innerText = "¬°Sigue as√≠!";
        } else {
            title.innerText = "Incorrecto";
            title.style.color = "var(--error)";
            let correctText = ((currentQuestion.type === 2) ? currentQuestion.correct : currentQuestion.correct) + "     " + currentQuestion.error_explanation; // Sin formato HTML para alert simple
            msg.innerHTML = `La respuesta correcta era: <strong>${correctText}</strong>`;
        }
        btn.onclick = nextQuestion;
    }

    function nextQuestion() {
        loadRandomQuestion();
    }

    function gameOver() {
        showModal(false); // Ya manejado dentro de showModal con lives <= 0
    }

    // Iniciar
    startGame();

</script>
</p>